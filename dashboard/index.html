<!DOCTYPE html>

<html lang="PT-br">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Robo fazendeiro</title>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.3.2/mdb.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <style>
        @font-face {
            font-family: 'fonte';
            src: url("../Akira.otf") format("opentype");
        }

        @font-face {
            font-family: 'centros';
            src: url("../LEMONMILK-MediumItalic.otf") format("opentype");
        }

        body {
            height: 100vh;
        }

        header {
            width: 100%;
        }

        .btn {
            border-radius: 3px;
        }

        .btnNav {}

        .AnimEsquerda {
            transform: translateX(-99%);
        }

        .AnimDireita {
            transform: translateX(99%);
        }

        .AnimOff {
            opacity: 1;
        }

        .mostrar {
            transform: translateX(0%);
            transform: translateY(0%);
            opacity: 1;
            transition: all ease-in-out 1s;
        }

        .menu-lateral {
            width: 50px;
            height: 100%;
            padding: 40px 0 40px 0;
            box-shadow: 0px 0 2px rgb(0, 0, 0);
            position: fixed;
            left: 0;
            top: 70px;
            overflow: hidden;
            transition: .6s;
        }

        .menu-lateral:hover {
            width: 300px;
        }

        main {
            margin-left: 50px;
            transition: margin-left .6s;
        }

        .menu-lateral:hover+main {
            margin-left: 310px;
            transition: .6s;
        }

        .menu-lateral>ul {
            height: 100%;
            list-style-type: none;
            padding-inline-start: 0;
        }

        .btn-expande {
            width: 100%;
            padding-left: 10px;
        }

        .btn-expande>i {
            color: wheat;
            font-size: 25pt;
        }

        .itemMenuLateral:hover {
            background-color: rgb(93, 93, 255);
        }

        .itemMenuLateral {
            transition: .6s;
        }

        .itemMenuLateral>a {
            border-top: 2px rgba(0, 0, 0, 0.205) solid;
            color: wheat;
            font-size: 20px;
            padding: 10px 0px;
            display: flex;
            line-height: 40px;
            text-decoration: none;
        }

        .itemMenuLateral {}

        .iconLateral {
            font-size: 22pt;
            margin-left: 10px;
        }

        .txt-link {
            margin-left: 40px;
            white-space: nowrap;
        }

        .dashbord-header {
            min-height: 120px;
        }
    </style>

</head>

<body>

    <nav class="position-fixed navbar navdecima navbar-expand-lg w-100 bg-opacity-100 bg-success"
        style="min-height: 70px;" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand fs-6 text-white" style="font-family: 'fonte';"
                href="https://bumbershoot.com.br/">Robo Fazendeiro</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">

                <span class="navbar-toggler-icon"></span>

            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                    <form class="container-fluid justify-content-start my-1">

                        <button data-href="../" id="inicio" class="btn btn-outline-warning fs-6 fw-medium mx-1"
                            type="button">Início</button>

                        <button href="/Dashboard" id="dashboard" class="btn btn-outline-warning fs-6 fw-medium mx-1"
                            type="button"><span style="text-decoration: underline;">Dashboard</span></button>

                        <button href="/SobreNos" id="sobreNos" class="btn btn-outline-warning fs-6 fw-medium mx-1"
                            type="button">Sobre o projeto</button>
                    </form>
                </ul>
            </div>
        </div>
    </nav>

    <nav class="menu-lateral bg-success">
        <div class="btn-expande d-flex">
            <i class="bi bi-list-task"></i>
            <h4 class="lh-lg ms-4">BUMBERSHOOT</h4>
        </div>
        <ul>
            <li class="itemMenuLateral" onclick="SidBarSelect('Dashbord')">
                <a href="#">
                    <span class="iconLateral"><i class="bi bi-sliders2"></i></span>
                    <span class="txt-link">Dashbord</span>
                </a>
            </li>
            <li class="itemMenuLateral" onclick="SidBarSelect('Tabelas')">
                <a href="#">
                    <span class="iconLateral"><i class="bi bi-table"></i></span>
                    <span class="txt-link">Tabelas</span>
                </a>
            </li>
            <li class="itemMenuLateral" onclick="SidBarSelect('Graficos')">
                <a href="#">
                    <span class="iconLateral"><i class="bi bi-graph-up"></i></span>
                    <span class="txt-link">Graficos</span>
                </a>
            </li>
            <li class="itemMenuLateral" onclick="SidBarSelect('Estatisticas')">
                <a href="#">
                    <span class="iconLateral"><i class="bi bi-info-square"></i></span>
                    <span class="txt-link">Estatisticas</span>
                </a>
            </li>
        </ul>
    </nav>
    <main class="" style="padding-top: 65px;">
        <div id="Dashbord" class="contentMain">
            <div class="dashbord-header bg-body-secondary d-flex flex-wrap">
                <div class="col-12 col-md-6 d-flex align-items-center justify-content-center">
                    <div class="border-2 border-black border h-75 rounded-4 text-black p-3" style="width: 95%;">
                        <h2 class="font-monospace m-0">Umidade:<span class="text-bg-info">2%</span></h2>
                        <p class="font-monospace fs-5 fw-light">ultima atualiçao: <span class="text-bg-success">hoje
                                07:02</span></p>
                    </div>
                </div>
                <div class="col-12 col-md-6 d-flex align-items-center justify-content-center">
                    <div class="border-2 border-black border h-75 rounded-4 text-black p-3" style="width: 95%;">
                        <h2 class="font-monospace m-0">Chuvas hoje:<span class="text-bg-info">1h:32m</span></h2>
                        <p class="font-monospace fs-5 fw-light">ultima atualiçao: <span class="text-bg-success">hoje
                                07:02</span></p>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-wrap">
                <div class="col-4">
                    <h4 class="text-center"> Ultimos lançamentos</h4>
                    <table class="table table-striped border border-2">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Data</th>
                                <th scope="col">Umidade</th>
                                <th scope="col">Chuvas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>28/06/2024</td>
                                <td>2%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>28/06/2024</td>
                                <td>16%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">4</th>
                                <td>28/06/2024</td>
                                <td>46%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">5</th>
                                <td>28/06/2024</td>
                                <td>34%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">6</th>
                                <td>28/06/2024</td>
                                <td>55%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">7</th>
                                <td>28/06/2024</td>
                                <td>85%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">8</th>
                                <td>28/06/2024</td>
                                <td>26%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">9</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">10</th>
                                <td>28/06/2024</td>
                                <td>17%</td>
                                <td>nao</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="container col-8">
                    <h4 class="text-center"> Grafico</h4>
                    <canvas id="chart-line"></canvas>
                </div>
            </div>
        </div>
        <div id="Tabelas" class="contentMain" style="display: none;">
            <div class="d-flex flex-wrap w-100">
                <div class="pt-2 bg-danger-subtle flex-fill" style="min-width: 250px;width: 33.33%;">
                    <h4 class="text-center"><span class="text-bg-danger">Diarias</span></h4>
                    <table class="table table-striped border border-1 m-0">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Data</th>
                                <th scope="col">Umidade</th>
                                <th scope="col">Chuvas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>28/06/2024</td>
                                <td>2%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>28/06/2024</td>
                                <td>16%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">4</th>
                                <td>28/06/2024</td>
                                <td>46%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">5</th>
                                <td>28/06/2024</td>
                                <td>34%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">6</th>
                                <td>28/06/2024</td>
                                <td>55%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">7</th>
                                <td>28/06/2024</td>
                                <td>85%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">8</th>
                                <td>28/06/2024</td>
                                <td>26%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">9</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">10</th>
                                <td>28/06/2024</td>
                                <td>17%</td>
                                <td>nao</td>
                            </tr>
                        </tbody>
                    </table>
                
                </div>
                <div class="pt-2 bg-danger-subtle flex-fill" style="min-width: 250px;width: 33.33%;">
                    <h4 class="text-center"><span class="text-bg-danger">Mensais</span></h4>
                    <table class="table table-striped border border-1 m-0">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Data</th>
                                <th scope="col">Umidade</th>
                                <th scope="col">Chuvas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>28/06/2024</td>
                                <td>2%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>28/06/2024</td>
                                <td>16%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">4</th>
                                <td>28/06/2024</td>
                                <td>46%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">5</th>
                                <td>28/06/2024</td>
                                <td>34%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">6</th>
                                <td>28/06/2024</td>
                                <td>55%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">7</th>
                                <td>28/06/2024</td>
                                <td>85%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">8</th>
                                <td>28/06/2024</td>
                                <td>26%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">9</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">10</th>
                                <td>28/06/2024</td>
                                <td>17%</td>
                                <td>nao</td>
                            </tr>
                        </tbody>
                    </table>
                
                </div>
                <div class="pt-2 bg-danger-subtle flex-fill" style="min-width: 250px;width: 33.33%;">
                    <h4 class="text-center"><span class="text-bg-danger">Anais</span></h4>
                    <table class="table table-striped border border-1 m-0">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Data</th>
                                <th scope="col">Umidade</th>
                                <th scope="col">Chuvas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>28/06/2024</td>
                                <td>2%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>28/06/2024</td>
                                <td>16%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">4</th>
                                <td>28/06/2024</td>
                                <td>46%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">5</th>
                                <td>28/06/2024</td>
                                <td>34%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">6</th>
                                <td>28/06/2024</td>
                                <td>55%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">7</th>
                                <td>28/06/2024</td>
                                <td>85%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">8</th>
                                <td>28/06/2024</td>
                                <td>26%</td>
                                <td>sim</td>
                            </tr>
                            <tr>
                                <th scope="row">9</th>
                                <td>28/06/2024</td>
                                <td>22%</td>
                                <td>nao</td>
                            </tr>
                            <tr>
                                <th scope="row">10</th>
                                <td>28/06/2024</td>
                                <td>17%</td>
                                <td>nao</td>
                            </tr>
                        </tbody>
                    </table>
                
                </div>
            </div>
        </div>
        <div id="Graficos" class="contentMain" style="display: none;">
            <h1>Graficos</h1>
            <p>Conteúdo dos Graficos...</p>
        </div>
        <div id="Estatisticas" class="contentMain" style="display: none;">
            <h1>Estatisticas</h1>
            <p>Conteúdo das Estatisticas...</p>
        </div>

    </main>
    <!-- MDB -->
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>


    function AtualizaData() {
        let data = null;
        $.ajax({
            url: 'https://farmbotapi.elementfx.com/GETDATA.php',
            method: 'GET',
            dataType: 'json',
            async: false, // Torna a chamada síncrona
            success: function (response) {
                data = response;
            },
            error: function (xhr, status, error) {
                console.error('Error fetching data:', status, error);
            }
        });
        return data;
    }

    let dados = AtualizaData();
    var chuvas = [];
    var umidades = [];
    var datas = [];
    /*
    // Percorre o array 'dados_segundos' e extrai os valores
    dados.dados_segundos.forEach(function(item) {
        chuvas.push(item.Chuva);
        umidades.push(item.Umidade);
        datas.push(item.Data);
    });
    */

    function converteChuva(valor) {
        return valor === "Nao" ? 0 : 1;
    }


    // Exemplo de uso dos arrays criados
    console.log(dados);


    let PegaOsDadosDeHj = {
        VerificaSeEHj: function (DataVerificar) {
            let partesDataDia = DataVerificar.split(" ");
            let partesData = partesDataDia[0].split("-");
            let dataFormatada = partesData[1] + "/" + partesData[2] + "/" + partesData[0];
            return new Date().toDateString() === new Date(dataFormatada).toDateString();
        },
        filtrarPorHoje: function (dados) {
            var dadosHoje = {
                "dados_segundos": [],
                "medias_diarias": []
            };

            dados.dados_segundos.forEach(function (item) {
                if (PegaOsDadosDeHj.VerificaSeEHj(item.Data)) {
                    dadosHoje.dados_segundos.push(item);
                }
            })
            /*
            dados.medias_diarias.forEach(function(item) {
                if (Utils.isHoje(item.Data)) {
                    dadosHoje.medias_diarias.push(item);
                }
            });
            */
            return dadosHoje;
        }
    }

    PegaOsDadosDeHj.filtrarPorHoje(dados).dados_segundos.forEach(function (item) {
        chuvas.push(converteChuva(item.Chuva));
        umidades.push(item.Umidade);
        datas.push(item.Data);
    });

    console.log(datas)
    //alert(new Date().toDateString())
    const backgroundPlugin = {
        id: 'backgroundPlugin',
        beforeDraw: (chart) => {
            const { ctx, chartArea: { top, bottom, left, right, height }, scales: { y } } = chart;

            // Converte os valores dos dados para posições no gráfico
            const yValueToPixel = value => y.getPixelForValue(value);

            // Define as cores e as áreas
            const colors = [
                { color: 'rgba(255, 0, 0, 0.3)', start: bottom, end: yValueToPixel(30) }, // Verde abaixo de 30
                { color: 'rgba(255, 255, 0, 0.3)', start: yValueToPixel(30), end: yValueToPixel(80) }, // Amarelo entre 30 e 80
                { color: 'rgba(0, 255, 0, 0.3)', start: yValueToPixel(80), end: top } // Vermelho acima de 80
            ];

            colors.forEach(({ color, start, end }) => {
                ctx.save();
                ctx.fillStyle = color;
                ctx.fillRect(left, end, right - left, start - end);
                ctx.restore();
            });

            // Adiciona a legenda
            const legendItems = [
                { text: 'Solo seco (0-30)', color: 'rgba(255, 0, 0, 0.3)' },
                { text: 'Solo moderado (30-80)', color: 'rgba(255, 255, 0, 0.3)' },
                { text: 'Solo úmido (80-100)', color: 'rgba(0, 255, 0, 0.3)' }
            ];

            const legendWidth = legendItems.reduce((acc, item) => {
                return acc + ctx.measureText(item.text).width + 50; // Espaço para o quadrado de cor e texto
            }, 0);
            const legendX = (right + left - legendWidth) / 2; // Posiciona a legenda centralizada horizontalmente
            const legendY = bottom + 30; // Posiciona a legenda logo abaixo do gráfico
            const legendSpacing = 200; // Espaçamento horizontal entre itens da legenda

            // Adiciona a legenda
            legendItems.forEach((item, index) => {
                const startX = legendX + index * legendSpacing;

                ctx.save();
                ctx.fillStyle = item.color;
                ctx.fillRect(startX, legendY, 10, 10);
                ctx.fillStyle = '#000';
                ctx.font = '12px Arial';
                ctx.fillText(item.text, startX + 15, legendY + 10);
                ctx.restore();
            });
        }
    };
    Chart.register(backgroundPlugin);

    // Dados e configurações do gráfico
    const dataLine = {
        type: "line",
        data: {
            labels: ['28/06/2024', '28/06/2024', '28/06/2024', '28/06/2024', '28/06/2024', '28/06/2024', '28/06/2024', '28/06/2024', '28/06/2024', '28/06/2024',],
            datasets: [{
                label: "Umidade",
                data: ['2', '16', '22', '46', '34', '55', '85', '26', 22, 17],
                borderColor: "rgb(1, 151, 252)",
                backgroundColor: "rgb(34, 0, 255)",
                fill: false,
                cubicInterpolationMode: 'monotone', // Adiciona suavização
            }, {
                label: "Chuva",
                data: [10, 0, 0, 10, 0, 10, 10, 10, 0, 0],
                borderColor: "rgb(34, 159, 53)",
                backgroundColor: "rgb(24, 79, 11)",
                fill: false,
            }],
        },
        options: {
            scales: {
                y: {
                    min: 0,
                    max: 100
                }
            },
            plugins: {
                backgroundPlugin: true
            },
            layout: {
                padding: {
                    bottom: 30 // Ajusta o padding inferior para garantir espaço para a legenda
                }
            }
        }
    };

    const ctx = document.getElementById('chart-line').getContext('2d');
    const myChart = new Chart('chart-line', dataLine);

    let currentURL = window.location.pathname.split("/").filter(Boolean).pop();
    console.log(currentURL)
    let urlMap = {
        "index.html": "inicio",
        "SobreNos": "sobreNos",
        "dashboard": "dashboard"
    };
    if (urlMap[currentURL]) {
        document.getElementById(urlMap[currentURL]).classList.add('active');
        document.getElementById(urlMap[currentURL]).classList.remove('btn-outline-warning');
        document.getElementById(urlMap[currentURL]).classList.add('btn-warning');
    }

    let Elementos = document.querySelectorAll('.AnimOff')
    Elementos.forEach((e) => Observador.observe(e))

    let EBotaoLink = document.querySelectorAll('[data-href]')
    EBotaoLink.forEach((x) => {
        x.addEventListener('click', (y) => {

            let win = window.open(x.getAttribute('data-href'), '_self');
            win.focus();
        })
    })

    function SidBarSelect(type) {
        document.querySelectorAll('.contentMain').forEach((x) => {
            if (x.id == type) {
                x.style.display = 'block';
            } else {
                x.style.display = 'none';
            }
        })
    }

</script>

</html>